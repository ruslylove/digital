\documentclass[tikz,border=10pt]{standalone}
\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning, calc, decorations.pathreplacing, shapes.misc}

\begin{document}

% Define function outside
\pgfmathdeclarefunction{signal}{1}{\pgfmathparse{2.5 + 1.8*sin(deg(#1))}}

\begin{tikzpicture}[
    font=\sffamily,
    analogColor/.style={color=red!80, line width=1.2pt},
    digitalColor/.style={color=blue!70!black, line width=1.5pt},
    gridColor/.style={color=gray!30, line width=0.5pt},
    axis/.style={->, >=Latex, line width=1pt, black!80},
    sample dot/.style={fill=blue!70!black, circle, inner sep=2pt},
    error arrow/.style={->, >=Latex, color=red, thin},
    small label/.style={font=\scriptsize, color=gray!60}
]

% Dimensions
\def\xMax{7.5}
\def\yMax{5}
\def\Ts{0.8} % Sampling Period

% --- 1. Draw Grid ---
\foreach \y in {1, 2, 3, 4} {
    \draw[gridColor] (0,\y) -- (\xMax,\y);
    \node[left, font=\scriptsize, color=gray] at (0,\y) {Level \y};
}
\node[left, font=\scriptsize, color=gray] at (0,0) {0};

% Vertical lines
\foreach \x in {0, \Ts, ..., \xMax} {
    \draw[gridColor, dashed] (\x,0) -- (\x,\yMax);
}

% --- 2. Draw Axes ---
\draw[axis] (0,0) -- (\xMax + 0.5, 0) node[right] {Time ($t$)};
\draw[axis] (0,0) -- (0, \yMax + 0.5) node[above] {Voltage ($V$)};

% --- 3. Analog Signal ---
\draw[analogColor, opacity=0.4] plot[domain=0:\xMax, samples=100] (\x, {signal(\x)});
\node[red!50, right] at (\xMax, {signal(\xMax)}) {Analog Input};


% --- 4. Digital Signal ---
% We use 'samples' carefully to match the sampling period for the step look
% 7.5 / 0.8 is approx 9.3, so we use enough samples to cover the steps
\draw[digitalColor] plot[const plot, domain=0:\xMax, samples=11] (\x, {round(signal(\x))});


% --- 5. Draw Sample Points and Error Arrows (THE FIX) ---
% We use an integer \i to name the nodes (0, 1, 2...) 
% and calculate the time \t inside the loop.
% Loop runs 0 to 9 (covering time 0 to 7.2)
\foreach \i in {0, 1, ..., 9} {
    
    % Calculate exact time t = index * period
    \pgfmathsetmacro{\t}{\i * \Ts}
    
    % Calculate values
    \pgfmathsetmacro{\analogVal}{signal(\t)}
    \pgfmathsetmacro{\digitalVal}{round(\analogVal)}
    
    % Draw Digital Dot (Name uses integer \i: dot-0, dot-1...)
    \node[sample dot] (dot-\i) at (\t, \digitalVal) {};
    
    % Draw "Ghost" point on analog curve (Name uses integer \i: real-0, real-1...)
    \node[cross out, draw=red!50, inner sep=1pt, scale=0.5] (real-\i) at (\t, \analogVal) {};
    
    % Draw Arrow using the robust names
    \draw[error arrow] (real-\i) -- (dot-\i);
}

% --- 6. Annotations ---
\draw[decorate, decoration={brace, amplitude=5pt, mirror}, thick, black!70] 
    (\Ts, -0.2) -- (2*\Ts, -0.2) 
    node[midway, below=5pt, font=\small] {$T_s$};

\draw[decorate, decoration={brace, amplitude=5pt}, thick, black!70] 
    (\xMax+0.1, 2) -- (\xMax+0.1, 3) 
    node[midway, right=5pt, font=\small, align=left] {Step ($Q$)};

\node[small label, text=red, align=center] (errLabel) at (3, 4.5) {Quantization\\Error};
% Point to specific node index 3 (time 2.4)
\draw[->, red, dashed] (errLabel) -- (real-3); 

\end{tikzpicture}

\end{document}